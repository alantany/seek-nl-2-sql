# 自然语言转SQL工具

一个基于大模型的自然语言转SQL查询工具，支持自然语言查询、SQL直接查询和大模型对话功能。

## 功能特点

- 自然语言转SQL查询
- SQL直接查询（带示例）
- 大模型对话
- 查询结果自动解释
- 实时模型状态监控

## 安装和配置

1. 克隆项目
```bash
git clone [项目地址]
cd [项目目录]
```

2. 安装依赖
```bash
pip install -r requirements.txt
```

3. 配置环境变量
创建.env文件并配置以下内容：
```env
DB_PATH=data/scott.db
OLLAMA_BASE_URL=http://your-ollama-server:port
DEEPSEEK_MODEL=your-model-name
```

## 提示词工程

本项目在与大模型交互时使用了精心设计的提示词策略：

### 1. SQL生成提示词

```python
system_prompt = """你是一个SQL专家，请将用户的自然语言转换为SQL查询语句。
目前的数据库表结构如下：

DEPT (部门表):
- DEPTNO: INTEGER PRIMARY KEY (部门编号)
- DNAME: TEXT (部门名称)
- LOC: TEXT (位置)

[其他表结构...]

请只返回SQL语句，不需要其他解释。"""
```

设计说明：
- 明确角色定位（SQL专家）
- 提供完整的表结构信息
- 要求只返回SQL语句，避免额外解释
- 包含字段的中英文对照

### 2. 结果解释提示词

```python
prompt = f"""请用简洁的语言解释以下SQL查询的结果：

SQL查询：
{sql}

查询结果：
{result_text}

请用通俗易懂的语言解释这个结果的含义，不需要解释SQL语句本身。"""
```

设计说明：
- 提供SQL和结果上下文
- 要求使用通俗易懂的语言
- 聚焦于结果解释而非SQL解释
- 保持简洁性

### 3. 思考过程处理

为了提供更清晰的输出，系统会过滤掉大模型的思考过程，包括：
- `<think>` 和 `</think>` 标记
- "好，"或"好。"开头的思考语句
- "首先，"开头的规划语句
- "接下来，"开头的过程语句

## 使用说明

1. 启动应用
```bash
streamlit run app.py
```

2. 功能说明

### 自然语言查询数据库
- 输入自然语言描述
- 系统自动转换为SQL
- 执行查询并显示结果
- 提供结果解释

### SQL查询
- 直接编写SQL
- 提供常用查询示例
- 实时执行结果

### 大模型对话
- 与模型自由对话
- 支持上下文理解
- 清晰的对话界面

## 开发者

Developer by Huaiyuan Tan

## 注意事项

- 确保Ollama服务正常运行
- 检查数据库文件权限
- 注意SQL注入风险

## 功能模块

1. **用户输入界面**
   - 提供一个简单直观的界面，用户可以输入自然语言查询。

2. **自然语言处理**
   - 使用DeepSeek模型解析用户输入的自然语言查询。

3. **SQL生成**
   - 将解析后的自然语言转换为SQL语句。

4. **SQL执行**
   - 连接到数据库并执行生成的SQL语句（可选）。

5. **结果展示**
   - 将SQL查询结果以表格形式展示给用户。

6. **错误处理**
   - 处理用户输入错误和SQL执行错误，并提供友好的错误信息。

## 未来计划

- **优化自然语言解析**：提高DeepSeek模型的解析准确性。
- **支持更多数据库**：扩展支持的数据库类型。
- **用户界面改进**：提升用户体验和界面美观度。

## 贡献

欢迎对本项目提出建议或贡献代码。请阅读`CONTRIBUTING.md`了解更多信息。

## 许可证

本项目采用MIT许可证。详情请参阅`LICENSE`文件。 